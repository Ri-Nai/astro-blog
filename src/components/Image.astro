---
// Image.astro - 优化的图片组件
export interface Props {
  src: string;
  alt?: string;
  class?: string;
  basePath?: string;
}

const { src, alt = "", class: className = "", basePath } = Astro.props;

// 处理图片路径
const getImageSrc = (imageSrc: string) => {
  // 如果是绝对路径或外部链接，直接返回
  if (imageSrc.startsWith("/") || imageSrc.startsWith("http")) {
    return imageSrc;
  }
  
  // 对于相对路径，添加basePath（如果提供了的话）
  if (basePath) {
    return `${basePath}/${imageSrc}`;
  }
  
  // 尝试自动推断basePath（基于当前文件路径）
  // 这需要从Astro的上下文获取信息
  const currentPath = Astro.url.pathname;
  if (currentPath.includes('/blog/')) {
    // 从URL路径推断图片路径
    const pathParts = currentPath.split('/');
    const blogIndex = pathParts.indexOf('blog');
    if (blogIndex !== -1 && pathParts.length > blogIndex + 1) {
      const blogPath = pathParts.slice(blogIndex + 1).join('/');
      return `/imgs/blog/${blogPath}/${imageSrc}`;
    }
  }
  
  // 如果没有提供basePath且无法自动推断，返回原路径
  return imageSrc;
};

const imageSrc = getImageSrc(src);
---

<!-- 生成img标签，但添加特殊标记让Gallery识别 -->
<img 
  src={imageSrc} 
  alt={alt} 
  class={`${className} image-component`}
  loading="lazy"
  data-image-component="true"
/>
